#!/bin/bash

# =================================================================
# サイトジャンル変更用プロンプト自動生成スクリプト (上書き保存版)
# =================================================================
# 目的: 既存のHTMLファイルの構造を維持しつつ、テキストコンテンツを
#       新しいテーマに合わせて刷新するためのAI指示書を生成します。

# ★新しいサイトのテーマやジャンルをここに定義します
NEW_THEME="医療脱毛クリニックの比較・ランキングサイト"
CONVERSION_ACTION="無料カウンセリングの申し込み"

# スクリプトが置かれている場所を基準に動作します
BASE_DIR="."

echo "プロンプト生成を開始します... (モード: サイトジャンル変更 / 上書き保存)"
echo "対象ディレクトリ: ${BASE_DIR}/CC作成"
echo "新テーマ: ${NEW_THEME}"
echo "----------------------------------------"

# 「00」から「99」までの2桁の数字で始まるフォルダにマッチするように修正
for section_dir in "${BASE_DIR}/CC作成/"[0-9][0-9]_*/; do
    # ディレクトリが存在するかチェック
    if [ ! -d "${section_dir}" ]; then
        continue
    fi

    # --- 基本的なパスと名前を定義 ---
    section_name=$(basename "${section_dir}") # 例: "01_Header"
    cc_dir="${section_dir%/}" # 末尾のスラッシュを削除 例: "./CC作成/01_Header"
    prompt_file="${cc_dir}/text_change_prompts.yaml"

    original_html_filename=$(echo "${section_name}" | tr '[:upper:]' '[:lower:]')".html"
    original_html_path="${cc_dir}/${original_html_filename}"

    # ▼▼▼▼▼【ここを修正しました】▼▼▼▼▼
    # 書き換え後のHTMLファイルパスを定義 (元のファイルに上書きするように変更)
    changed_html_path="${original_html_path}"
    # ▲▲▲▲▲【ここまで修正しました】▲▲▲▲▲

    echo "処理中: ${section_name}"

    if [ ! -f "${original_html_path}" ]; then
        echo "  [警告] 書き換え対象のHTMLファイル '${original_html_path}' が見つかりません。このセクションをスキップします。"
        continue
    fi

    # --- セクションごとの具体的なテキスト生成指示を定義 ---
    section_specific_goal=""
    case "${section_name}" in
        "01_Header"*)
            section_specific_goal="サイト全体の信頼性と権威性を一目で伝える、簡潔で力強いキャッチコピーを配置してください。例:『後悔しない医療脱毛の選び方』『専門家が選ぶ人気クリニック』など。"
            ;;
        "02_MainVisual"*)
            section_specific_goal="ユーザーが最初に目にする最重要エリアです。ユーザーの悩みに共感し、このサイトがその解決策を提示することを示す、最もインパクトのある訴求（キャッチコピーやリード文）を考えてください。ランキング1位のクリニックをチラ見せするのも効果的です。"
            ;;
        "03_SearchForm"*)
            section_specific_goal="ユーザーが目的のクリニックをすぐに見つけられるように、検索や絞り込み機能の意図を明確に伝えるテキストを配置してください。例:『エリアや特徴でピッタリのクリニックを探す』など。"
            ;;
        "04_RankingResults"*)
            section_specific_goal="ランキングの結果を紹介するセクションです。なぜその順位なのか、根拠（例:『料金満足度』『予約の取りやすさ』）を明確に示し、各クリニックの最も魅力的なポイントを要約してください。"
            ;;
        "05_Tips"*)
            section_specific_goal="ユーザーの判断を助けるための豆知識や補足情報を提示するセクションです。クリニック選びで失敗しないためのポイントや、知っておくと得する情報を簡潔にまとめてください。"
            ;;
        "06_ComparisonTable"*)
            section_specific_goal="ユーザーがクリニックを比較検討するための最重要セクションです。各クリニックの『強み』『料金プラン』『通いやすさ』『実績』などを、表形式で分かりやすく整理してください。専門用語は避け、直感的にメリットが伝わる言葉を選んでください。"
            ;;
        "07_DetailedContent"*)
            section_specific_goal="各クリニックの詳細を紹介するセクションです。公式サイトだけでは分からない『リアルな口コミ』『おすすめポイント』『注意点』などを深掘りして解説してください。ユーザーが『ここなら自分に合っているかも』と思えるような、具体的で説得力のある情報を提供してください。"
            ;;
        "08_Columns"*)
            section_specific_goal="ユーザーが抱えるであろう疑問や不安（例:『痛みは？』『効果はいつから？』『総額はいくら？』）に答えるQ&Aコンテンツや解説記事を作成してください。専門性と信頼性を示しつつ、親しみやすい口調で丁寧に解説することが重要です。"
            ;;
        "09_Footer"*)
            section_specific_goal="サイト全体の情報を整理し、ユーザーが求める情報へスムーズに移動できるようにナビゲーションを最適化してください。運営者情報やプライバシーポリシーへのリンクを明記し、サイトの信頼性を補強します。"
            ;;
        *)
            section_specific_goal="このセクションの役割を考慮し、ユーザーのコンバージョンを促すための最適なテキストを配置してください。"
            ;;
    esac

    # --- プロンプト本体の生成 ---
    cat > "${prompt_file}" <<EOF
# ===============================================================
#  Webサイト テキストコンテンツ変更 指示書 (上書きモード)
# ===============================================================

# 1. あなたの役割と使命 (Your Role and Mission)
# ---------------------------------------------------------------
# あなたは、コンバージョン率最適化（CRO）を専門とするトップクラスのWebコピーライターです。
# あなたの使命は、指定されたWebサイトのHTML構造を維持したまま、テキストコンテンツを全面的に刷新し、ターゲットユーザーのコンバージョン（${CONVERSION_ACTION}）を最大化することです。

# 2. プロジェクトの背景と目的 (Project Background & Goal)
# ---------------------------------------------------------------
project_context:
  purpose: "リスティング広告からの流入を最大化するための、ランキングサイトのコンテンツ改修。"
  new_theme: "${NEW_THEME}"
  target_audience:
    description: "どのクリニックやサービスにするか迷っている。契約意欲は高いが、選択肢が多すぎて決めきれていない。検索広告経由で、早く信頼できる情報を得たいと考えているユーザー。"
  ultimate_goal: "ユーザーが当サイトの情報を元に、紹介されているクリニックの公式サイト/LPへ遷移し、最終的に${CONVERSION_ACTION}をしてもらうこと。"

# 3. タスク定義 (Task Definition)
# ---------------------------------------------------------------
task_definition:
  - "入力ファイル（input_html_path）を読み込む。"
  - "下記の指示に基づき、ファイル内の全てのテキストコンテンツを「${NEW_THEME}」というテーマに沿って全面的に書き換える。"
  - "【最重要ルール】: HTMLの構造（タグ、ID、クラス名など）は一切変更しないこと。テキストノードの中身だけを変更する。"
  - "書き換えた結果で、元のファイル（output_html_path）を完全に上書き保存する。"

# 4. 入出力ファイル (Input/Output Files)
# ---------------------------------------------------------------
# 入力元と出力先が同じパスです。つまり、ファイルを上書きします。
input_html_path: "${original_html_path}"
output_html_path: "${changed_html_path}"

# 5. セクション固有の実行指示 (Section-Specific Instructions)
# ---------------------------------------------------------------
# 現在の作業対象セクション: ${section_name}
section_specific_goal: >
  ${section_specific_goal}

# 6. ライティングのトーン＆マナー (Tone and Manner)
# ---------------------------------------------------------------
writing_style:
  - "【専門性と信頼性】: 読者が安心して相談・契約できるよう、専門家としての視点と信頼できるデータに基づいた表現を心がける。"
  - "【共感と寄り添い】: ユーザーの悩みや不安に共感し、解決策を提示するような、親しみやすく丁寧な口調を基本とする。"
  - "【簡潔明瞭】: ユーザーは情報を素早く得たいと考えているため、冗長な表現を避け、要点を的確に伝えることを最優先する。"
  - "【行動喚起】: 各セクションの終わりに、次のアクション（例:「公式サイトで詳細を見る」「無料カウンセリングはこちら」）へ自然に誘導するような文言を配置する。"
  - "【ランキング表現】: ランキングやおすすめ度を示す際は、その根拠（例:「料金の安さNo.1」「口コミ評価4.5以上」）を明確にし、説得力を持たせること。"

# 7. 実行指示 (Execution Command)
# ---------------------------------------------------------------
# 上記の全ての指示を理解し、タスクを実行してください。
# 最終的な成果物は、'output_html_path'に指定されたパスに、ファイルを上書き保存してください。
EOF

    echo "  [成功] '${prompt_file}' を生成しました。"
    echo "    - 処理対象(上書き): ${original_html_path}"

done

echo "----------------------------------------"
echo "全てのテキスト変更用プロンプトの生成が完了しました。"